@model List<string>
@{
    ViewData["Title"] = "Administración de Bases de Datos";
}

<!-- Estilos personalizados para tema rosa pastel -->
<style>
    /* Color principal rosa pastel */
    .pastel-bg {
        background-color: #ffb6c1 !important; /* Light Pink */
    }

    .pastel-border {
        border-color: #ffb6c1 !important;
    }

    /* Tarjeta con header en rosa pastel */
    .pastel-card-header {
        background-color: #ffb6c1;
        color: #ffffff;
    }

    /* Botones personalizados */
    .btn-pastel {
        background-color: #ffb6c1;
        border-color: #ffb6c1;
        color: #fff;
    }

    .btn-pastel:hover {
        background-color: #ffa6b8;
        border-color: #ffa6b8;
        color: #fff;
    }
</style>

<div class="container mt-4">
    <h2>@ViewData["Title"]</h2>

    <!-- Contenedor de 3 cards por hilera -->
    <div class="row">
        <!-- Card: Bases de Datos Existentes -->
        <div class="col-md-4 mb-3">
            <div class="card pastel-border">
                <div class="card-header pastel-card-header">
                    <h4>Bases de Datos Existentes</h4>
                </div>
                <div class="card-body">
                    <ul class="list-group">
                        @foreach (var db in Model)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                @db
                                <div>
                                    <a href="/Security/Users?database=@db" class="btn btn-sm btn-pastel">Usuarios</a>
                                    <a href="#" class="btn btn-sm btn-danger">Eliminar</a>
                                </div>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>

        <!-- Card: Nueva Base de Datos -->
        <div class="col-md-4 mb-3">
            <div class="card pastel-border">
                <div class="card-header pastel-card-header">
                    <h4>Nueva Base de Datos</h4>
                </div>
                <div class="card-body">
                    <form asp-action="CreateDatabase">
                        <div class="input-group">
                            <input type="text" class="form-control" name="databaseName"
                                   placeholder="Nombre de la base de datos" required>
                            <button type="submit" class="btn btn-pastel">Crear</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Card: Gestión de Backups -->
        <div class="col-md-4 mb-3">
            <div class="card pastel-border">
                <div class="card-header pastel-card-header">
                    <h4>Backups</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Sección Exportar -->
                        <div class="col-md-6">
                            <h5>Exportar colección</h5>
                            <form asp-controller="ExportImport" asp-action="Export" method="post">
                                <div class="form-group">
                                    <label>Base de Datos:</label>
                                    <select name="database" class="form-control" required>
                                        <option value="">Seleccione una base de datos</option>
                                        @foreach (var db in Model)
                                        {
                                            <option value="@db">@db</option>
                                        }
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-pastel mt-2">Exportar Backup</button>
                            </form>
                        </div>

                        <!-- Sección Importar -->
                        <div class="col-md-6">
                            <h5>Importar Backup</h5>
                            <form asp-controller="ExportImport" asp-action="Import" method="post" enctype="multipart/form-data">
                                <div class="form-group">
                                    <label>Base de Datos:</label>
                                    <select name="database" class="form-control" required>
                                        <option value="">Seleccione una base de datos</option>
                                        @foreach (var db in Model)
                                        {
                                            <option value="@db">@db</option>
                                        }
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Archivo ZIP:</label>
                                    <input type="file" name="file" class="form-control-file" accept=".zip" required />
                                </div>
                                <button type="submit" class="btn btn-pastel mt-2">Importar Backup</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script para manejar los cambios en selección de base de datos -->
    <script>
        $(document).ready(function () {
            $('#databaseSelect').change(function () {
                var db = $(this).val();
                if (db) {
                    $('#collectionSelect').prop('disabled', false);
                    $.getJSON('/ExportImport/GetCollections?database=' + db, function (data) {
                        var options = '<option value="">Seleccione una colección</option>';
                        $.each(data, function (i, item) {
                            options += '<option value="' + item + '">' + item + '</option>';
                        });
                        $('#collectionSelect').html(options);
                    });
                } else {
                    $('#collectionSelect').prop('disabled', true).html('<option value="">Seleccione primero una base de datos</option>');
                }
            });
        });
    </script>
</div>
